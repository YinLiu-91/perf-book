---
typora-root-url: ..\..\img
---

# Performance Analysis Approaches {#sec:sec_PerfApproaches}

在进行高级优化时，通常很容易判断性能是否有所提高。当您编写更好的算法版本时，您希望看到程序运行时间的明显差异。但是，在某些情况下，您会看到执行时间发生了变化，但您不知道它来自哪里。单独的时间并不能提供任何关于为什么会发生这种情况的洞察力。在这种情况下，我们需要更多关于我们的程序如何执行的信息。这就是我们需要进行性能分析以了解我们观察到的减速或加速的潜在性质的情况。

在我们的程序运行时，硬件和软件都会跟踪性能数据。在这种情况下，硬件是指 CPU，它执行程序，软件是指操作系统和所有启用分析的工具。通常，SW 堆栈提供高级指标，如时间、上下文切换次数和页面错误，而 CPU 能够观察缓存未命中、分支错误预测等。根据我们试图解决的问题，一些指标会比其他人更有用。因此，这并不意味着硬件指标总能为我们提供更精确的程序执行概览。一些指标，例如上下文切换的数量，不能由 CPU 提供。性能分析工具，如“Linux perf”，可以使用来自操作系统和 CPU 的数据。

我们将在本书中广泛使用 Linux `perf`，因为它是最流行的性能分析工具之一。该工具在大多数 Linux 发行版上都可用，因此可供广大用户使用。作者更喜欢展示 Linux `perf` 的另一个原因是它是开源的，这使我们能够看到典型分析工具中发生的事情的机制。这对于学习本书中介绍的概念特别有用，因为基于 GUI 的工具，如英特尔® VTune™ Profiler，往往会隐藏所有的复杂性。有关 Linux `perf` 的更多信息，请访问其 [wiki 页面](https://perf.wiki.kernel.org/index.php/Main_Page)[^1]。

在本章中，我们将介绍一些最流行的性能分析技术：代码检测、跟踪、表征和采样。我们还讨论了不涉及运行实际应用程序的静态性能分析技术和编译器优化报告。

[^1]: Linux perf wiki - [https://perf.wiki.kernel.org/index.php/Main_Page](https://perf.wiki.kernel.org/index.php/Main_Page).
